{% load static %}
{% load crispy_forms_tags %}
{% load humanize %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}
<!-- Mensajes -->
{% if messages %}
<div class="alert-container"style="
    z-index: 99999;
    position: fixed;
    margin-left: 40%;
    width: 30%;">

    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- CONTENEDOR PRINCIPAL -->
<div class="main-container">
  <div class="content-row"  style= "width: 100% ;">

    <!-- SIDEBAR -->
    <nav id="sidebar" class="sidebar" style="position: static;">
      <div class="sidebar-brand">
        <h5 class="mb-2">
          <i class="fas fa-warehouse me-2"></i>{{ empresa.nombre }}
        </h5>
        <h5 class="mb-2">
         <i class="fas fa-id-card me-1"></i> {{ empresa.rut }}
        </h5>
        <h5 class="mb-2">
          <i class="fas fa-map-marker-alt me-1"></i> {{ empresa.direccion|truncatechars:20 }}
        </h5>
        <h5 class="mb-2">
          <i class="fas fa-phone me-1"></i> {{ empresa.telefono }}
        </h5>
        <small class="text-light opacity-75">Módulo de Gestión de Stock</small>
        <div class="mt-3">
          
        </div>
      </div>
     
      
      <div class="flex-grow-1">
        <ul class="nav flex-column">
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'dashboard' or not active_panel %}active{% endif %}" data-target="#panel-dashboard">
              <i class="fas fa-chart-line"></i>Resumen
            </button>
          </li>
          <!-- NUEVO BOTÓN GRÁFICOS -->
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'graficos' %}active{% endif %}" data-target="#panel-graficos">
              <i class="fas fa-chart-bar"></i> Gráficos
            </button>
          </li>
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'ingreso' %}active{% endif %}" data-target="#panel-ingreso">
              <i class="fas fa-arrow-down"></i>Ingreso de Stock
            </button>
          </li>
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'egreso' %}active{% endif %}" data-target="#panel-egreso">
              <i class="fas fa-arrow-up"></i>Egreso de Stock
            </button>
          </li>
          {% if request.user.role == 'bodeguero' or request.user.role == 'admin' %}
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'centro' %}active{% endif %}" data-target="#panel-centro">
              <i class="fas fa-truck"></i>Proveedores
            </button>
          </li>
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'concepto-ingreso' %}active{% endif %}" data-target="#panel-concepto-ingreso">
              <i class="fas fa-box"></i>Productos
            </button>
          </li>
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'concepto-egreso' %}active{% endif %}" data-target="#panel-concepto-egreso">
              <i class="fas fa-shopping-cart"></i>Pedidos
            </button>
          </li>
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'rcv' %}active{% endif %}" data-target="#panel-rcv">
              <i class="fas fa-file-alt"></i>Reportes
            </button>
          </li>
          {% endif %}
          {% if request.user.role == 'admin' %}
          <li class="nav-item mb-2">
            <button class="btn sidebar-btn {% if active_panel == 'parametros-sii' %}active{% endif %}" data-target="#panel-parametros-sii">
              <i class="fas fa-users"></i>Usuarios
            </button>
          </li>
          {% endif %}
          <li>
            <a href="{% url 'logout' %}" class="btn sidebar-btn">
              <i class="fas fa-sign-out-alt"></i>Cerrar Sesión
            </a>
          </li>
        </ul>
        
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="main-content" style="padding-left: 5%; width: 100%;">

      <!-- DASHBOARD -->
      <div id="panel-dashboard" class="panel {% if active_panel != 'dashboard' %}d-none{% endif %}">
        <div class="dashboard-grid">

          <!-- IZQUIERDA -->
          <div class="dashboard-main">
            <h3 class="form-section-title mb-4">Resumen General</h3>

            <!-- TARJETAS -->
            <div class="row mb-5">
              <div class="col-md-3 mb-3">
                <div class="card stat-card">
                  <div class="stat-icon text-primary"><i class="fas fa-boxes"></i></div>
                  <div class="stat-value">{{ total_productos }}</div>
                  <div class="stat-label">Productos</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card stat-card">
                  <div class="stat-icon text-warning"><i class="fas fa-exclamation-triangle"></i></div>
                  <div class="stat-value">{{ stock_bajo }}</div>
                  <div class="stat-label">Stock Bajo</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card stat-card">
                  <div class="stat-icon text-success"><i class="fas fa-dollar-sign"></i></div>
                  <div class="stat-value">${{ ganancia_real|intcomma }}</div>
                  <div class="stat-label">Ganancia Real</div>
                </div>
              </div>
              <div class="col-md-3 mb-3">
                <div class="card stat-card">
                  <div class="stat-icon text-info"><i class="fas fa-chart-line"></i></div>
                  <div class="stat-value">${{ ganancia_estimada_total|intcomma }}</div>
                  <div class="stat-label">Ganancia Potencial</div>
                </div>
              </div>
            </div>

            <!-- GRÁFICOS -->
            

            <!-- MOVIMIENTOS RECIENTES -->
            <div class="card mb-4">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>Últimos Movimientos</h5>
              </div>
              <div class="card-body p-0">
                <div class="table-responsive">
                  <table class="table table-hover mb-0">
                    <thead class="table-light">
                      <tr>
                        <th>Fecha</th>
                        <th>Producto</th>
                        <th>Tipo</th>
                        <th>Cantidad</th>
                        <th>Valor</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for t in ultimos_movimientos %}
                      <tr>
                        <td>{{ t.fecha|date:"d/m H:i" }}</td>
                        <td><strong>{{ t.inventario.producto.nombre }}</strong></td>
                        <td>
                          {% if t.tipo == 'ingreso' %}
                          <span class="badge bg-success">Ingreso</span>
                          {% else %}
                          <span class="badge bg-danger">Egreso</span>
                          {% endif %}
                        </td>
                        <td>{{ t.cantidad|intcomma }}</td>
                        <td>
                          {% if t.tipo == 'ingreso' %}
                          <span class="text-success">+${{ t.costo_total|intcomma }}</span>
                          {% else %}
                          <span class="text-danger">-${{ t.venta_total|intcomma }}</span>
                          {% endif %}
                        </td>
                      </tr>
                      {% empty %}
                      <tr><td colspan="5" class="text-center py-4 text-muted">No hay movimientos</td></tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>

            <!-- INVENTARIO -->
            <div class="table-container">
              <h5 class="form-section-title mb-4">Inventario Actual</h5>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Producto</th>
                      <th>Cantidad</th>
                      <th>Stock Mín.</th>
                      <th>Costo Total</th>
                      <th>Ganancia Potencial</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for inv in inventarios %}
                    <tr class="{% if inv.cantidad < inv.stock_minimo %}table-danger{% endif %}">
                      <td><strong>{{ inv.producto.nombre }}</strong></td>
                      <td>{{ inv.cantidad|intcomma }}</td>
                      <td>{{ inv.stock_minimo|intcomma }}</td>
                      <td>${{ inv.val|intcomma }}</td>
                      <td class="text-success fw-bold">${{ inv.ganancia_estimada|intcomma }}</td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- DERECHA: RESUMEN RÁPIDO -->
          <div class="dashboard-sidebar-right">
            <div class="sticky-top" style="top:20px;">
              <h5 class="sidebar-title"><i class="fas fa-clipboard-list me-2"></i>Resumen Rápido</h5>
              <div class="summary-card mb-4">
                <h6 class="text-primary mb-3">Stock Actual</h6>
                <div class="summary-list">
                  {% for inv in inventarios %}
                  <div class="summary-item">
                    <span class="product-name">{{ inv.producto.nombre }}</span>
                    <span class="badge bg-primary">{{ inv.cantidad|intcomma }} und.</span>
                  </div>
                  {% endfor %}
                </div>
              </div>
              <div class="summary-card">
                <h6 class="text-success mb-3">Ganancia Potencial</h6>
                <div class="summary-list">
                  {% for inv in inventarios %}
                  <div class="summary-item">
                    <span class="product-name">{{ inv.producto.nombre }}</span>
                    <span class="badge bg-success">${{ inv.ganancia_estimada|intcomma }}</span>
                  </div>
                  {% endfor %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- ==================== NUEVO PANEL GRÁFICOS ==================== -->
      <div id="panel-graficos" class="panel {% if active_panel != 'graficos' %}d-none{% endif %}" style="width:95%;margin:0 auto;">
        <h3 class="form-section-title text-center mb-5"><i class="fas fa-chart-bar me-3"></i>Gráficos de Gestión</h3>

        <div class="row">
          <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>Flujo de Movimientos - Últimos 8 días</h5>
              </div>
              <div class="card-body">
                <canvas id="movementsChart"></canvas>
              </div>
            </div>
          </div>

          <div class="col-lg-6 mb-4">
            <div class="card h-100 shadow-sm">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-dollar-sign me-2"></i>Ganancia Estimada por Producto</h5>
              </div>
              <div class="card-body">
                <canvas id="profitsChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- PANEL: Ingreso de Stock -->  

      <div id="panel-ingreso" class="panel {% if active_panel != 'ingreso' %}d-none{% endif %}"
      style="width: 40%;">
        <div class="form-container">
          <h3 class="form-section-title">Ingreso de Stock</h3>
          <form method="post" id="form-ingreso" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="ingreso">
           
            {{ stock_exit_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-success btn-action" type="submit">
                <i class="fas fa-plus-circle me-2"></i>Registrar Ingreso
              </button>
            </div>
            
          </form>
        </div>
      </div>

      <!-- PANEL: Egreso de Stock -->
      <div id="panel-egreso" class="panel {% if active_panel != 'egreso' %}d-none{% endif %}"
      style="width: 40%;">
        <div class="form-container">
          <h3 class="form-section-title">Egreso de Stock</h3>
          <form method="post" id="form-egreso" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="egreso">
            {{ stock_entry_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-danger btn-action" type="submit">
                <i class="fas fa-minus-circle me-2"></i>Registrar Egreso
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- PANEL: Proveedores -->
      <div id="panel-centro" class="panel {% if active_panel != 'centro' %}d-none{% endif %}"
      style="width: 40%;">
        <div class="form-container">
          <h3 class="form-section-title">Nuevo Proveedor</h3>
          <form method="post" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="proveedor">
            {% if proveedor_form.instance.pk %}
            <input type="hidden" name="pk" value="{{ proveedor_form.instance.pk }}">
            {% endif %}
            {{ proveedor_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-secondary btn-action" type="submit">
                <i class="fas fa-plus-circle me-2"></i>{% if proveedor_form.instance.pk %}Actualizar{% else %}Crear{% endif %} Proveedor
              </button>
            </div>
          </form>
          <div class="table-container mt-4">
            <h5 class="form-section-title mb-4">Proveedores Existentes</h5>
            {% if proveedores %}
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Contacto</th>
                    <th>Email</th>
                    <th>Teléfono</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for prov in proveedores %}
                  <tr>
                    <td>{{ prov.nombre }}</td>
                    <td>{{ prov.contacto }}</td>
                    <td>{{ prov.email }}</td>
                    <td>{{ prov.telefono }}</td>
                    <td>
                      <a href="?panel=centro&edit_proveedor={{ prov.pk }}" class="btn btn-warning btn-sm">Editar</a>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete_proveedor">
                        <input type="hidden" name="pk" value="{{ prov.pk }}">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que quieres eliminar ?');">Eliminar</button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="empty-state">
              <i class="fas fa-truck"></i>
              <p class="mt-3">No hay proveedores registrados</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- PANEL: Productos -->
      <div id="panel-concepto-ingreso" class="panel {% if active_panel != 'concepto-ingreso' %}d-none{% endif %}"
      style="width: 60%;">
        <div class="form-container">
          <h3 class="form-section-title">Nuevo Producto</h3>
          <form method="post" class="compact-form">
           {% if form.errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            {% csrf_token %}
            <input type="hidden" name="form_type" value="producto">
            {% if producto_form.instance.pk %}
            <input type="hidden" name="pk" value="{{ producto_form.instance.pk }}">
            {% endif %}
            {{ producto_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-secondary btn-action" type="submit">
                <i class="fas fa-plus-circle me-2"></i>{% if producto_form.instance.pk %}Actualizar{% else %}Crear{% endif %} Producto
              </button>
            </div>
          </form>
          <div class="table-container mt-4">
            <h5 class="form-section-title mb-4">Productos Existentes</h5>
            {% if productos %}
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Nombre</th>
                    <th>Descripción</th>
                    <th>Unidad</th>
                    <th>Precio Costo</th>
                    <th>Precio Venta</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for prod in productos %}
                  <tr>
                    <td>{{ prod.nombre }}</td>
                    <td>{{ prod.descripcion|truncatechars:30 }}</td>
                    <td>{{ prod.unidad }}</td>
                    <td>${{ prod.precio_unitario|intcomma }}</td>
                    <td>${{ prod.precio_venta|intcomma }}</td>
                    <td>
                      <a href="?panel=concepto-ingreso&edit_producto={{ prod.pk }}" class="btn btn-warning btn-sm">Editar</a>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete_producto">
                        <input type="hidden" name="pk" value="{{ prod.pk }}">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que quieres eliminar ?');">Eliminar</button>
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="empty-state">
              <i class="fas fa-box"></i>
              <p class="mt-3">No hay productos registrados</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- PANEL: Pedidos -->
      <div id="panel-concepto-egreso" class="panel {% if active_panel != 'concepto-egreso' %}d-none{% endif %}"
      style="width: 60%;">
        <div class="form-container">
          <h3 class="form-section-title">Nuevo Pedido</h3>
          <form method="post" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="pedido">
            {% if pedido_form.instance.pk %}
            <input type="hidden" name="pk" value="{{ pedido_form.instance.pk }}">
            {% endif %}
            {% if form.errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for field in form %}
                        {% for error in field.errors %}
                            <li>{{ field.label }}: {{ error }}</li>
                        {% endfor %}
                    {% endfor %}
                    {% for error in form.non_field_errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
            {{ pedido_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button class="btn btn-secondary btn-action" type="submit">
                <i class="fas fa-plus-circle me-2"></i>{% if pedido_form.instance.pk %}Actualizar{% else %}Crear{% endif %} Pedido
              </button>
            </div>
          </form>
          <div class="table-container mt-4">
            <h5 class="form-section-title mb-4">Pedidos Existentes</h5>
            {% if pedidos %}
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Proveedor</th>
                    <th>Producto</th>
                    <th>Cantidad</th>
                    <th>Fecha Pedido</th>
                    <th>Fecha Vencimiento</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for ped in pedidos %}
                  <tr class="{% if ped.esta_vencido %}table-danger{% endif %}">
                    <td>{{ ped.proveedor.nombre }}</td>
                    <td>{{ ped.producto.nombre }}</td>
                    <td>{{ ped.cantidad }}</td>
                    <td>{{ ped.fecha_pedido|date:"d/m/Y" }}</td>
                    <td>{{ ped.fecha_vencimiento|date:"d/m/Y"|default:"-" }}</td>
                    <td>{{ ped.estado }}</td>
                    <td>
                      <a href="?panel=concepto-egreso&edit_pedido={{ ped.pk }}" class="btn btn-warning btn-sm">Editar</a>
                      <form method="post" class="d-inline">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete_pedido">
                        <input type="hidden" name="pk" value="{{ ped.pk }}">
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Estás seguro de que quieres eliminar ?');">Eliminar</button>
                         
                      </form>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="empty-state">
              <i class="fas fa-shopping-cart"></i>
              <p class="mt-3">No hay pedidos registrados</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- PANEL: Reportes -->
      <div id="panel-rcv" class="panel {% if active_panel != 'rcv' %}d-none{% endif %}"
      style="width: 60%;">
        <h3 class="form-section-title mb-4">Generar Reporte</h3>
        <form method="post" class="compact-form mb-5">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="reporte">
          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-group">
                <label for="tipo">Tipo de Reporte</label>
                <select name="tipo" id="tipo" class="form-control">
                  <option value="Ingreso">Ingreso de Stock</option>
                  <option value="Egreso">Egreso de Stock</option>
                  <option value="Resumen">Resumen de Inventario</option>
                </select>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="fecha_desde">Desde</label>
                <input type="date" name="fecha_desde" id="fecha_desde" class="form-control">
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-group">
                <label for="fecha_hasta">Hasta</label>
                <input type="date" name="fecha_hasta" id="fecha_hasta" class="form-control">
              </div>
            </div>
          </div>
          <div class="d-flex justify-content-end mt-3">
            <button type="submit" class="btn btn-primary">Generar Reporte</button>
          </div>
        </form>

        <h5 class="form-section-title mb-4">Reportes Generados</h5>
        {% if reportes %}
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
              <tr>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Contenido</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for rep in reportes %}
              <tr>
                <td>{{ rep.tipo }}</td>
                <td>{{ rep.fecha|date:"d/m/Y H:i" }}</td>
                <td><pre id="report-{{ rep.id }}">{{ rep.contenido }}</pre></td>
                <td>
                  <button onclick="downloadReport({{ rep.id }})" class="btn btn-info btn-sm">Descargar PDF</button>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="empty-state">
          <i class="fas fa-file-alt fa-3x"></i>
          <p class="mt-3">No hay reportes generados. Usa el formulario superior para generar uno.</p>
        </div>
        {% endif %}
      </div>
      
      <!-- PANEL: Usuarios -->
      <div id="panel-parametros-sii" class="panel {% if active_panel != 'parametros-sii' %}d-none{% endif %}"
      style="width: 60%;">
        <div class="form-container">
          <h3 class="form-section-title mb-4">
            <i class="fas fa-users text-warning me-2"></i> Registro de Usuarios
          </h3>
          <form method="post" class="compact-form">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="usuario">
            {{ user_form|crispy }}
            <div class="d-flex justify-content-end mt-4">
              <button type="submit" class="btn btn-warning btn-lg px-5">
                <i class="fas fa-save me-2"></i> Registrar Usuario
              </button>
            </div>
          </form>
          <div class="table-container mt-4">
            <h5 class="form-section-title mb-4">Usuarios Existentes</h5>
            {% if usuarios %}
            <ul class="centros-list">
              {% for user in usuarios %}
              <li>
                <strong>{{ user.username }}</strong> - {{ user.role }}
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <div class="empty-state">
              <i class="fas fa-users"></i>
              <p class="mt-3">No hay usuarios registrados</p>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

    </main>

  
</div>
<!-- FOOTER -->
 

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/home.js' %}"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
  document.querySelectorAll('.sidebar-btn').forEach(btn => {
    btn.addEventListener('click', function () {
      document.querySelectorAll('.panel').forEach(p => p.classList.add('d-none'));
      document.querySelector(this.dataset.target).classList.remove('d-none');
      document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
    });
  });
});
function downloadReport(id) {
  const el = document.getElementById('report-' + id);
  if (!el) return alert("Error");
  html2pdf().from(el).set({ margin: 1, filename: 'reporte.pdf', html2canvas: { scale: 2 } }).save();
}
</script>
